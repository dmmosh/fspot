
<!DOCTYPE html>
<html>
<head>
    <link rel="shortcut icon" href="#">
    <title>fspot</title>
</head>
<body>

    <h1>DEBUGGING</h1>
    <p id="debug"></p>
    <button id="togglePlay">Toggle Play</button>
    <script type="text/javascript" src="https://sdk.scdn.co/spotify-player.js" ></script>
    <script>

        setInterval(                               //Periodically 
          function()
          {
             $.getJSON(                            //Get some values from the server
                $SCRIPT_ROOT + '/get_values',      // At this URL
                {},                                // With no extra parameters
                function(data)                     // And when you get a response
                {
                  $("#result").text(data.result);  // Write the results into the 
                                                   // #result element
                });
          },
          500);                                    // And do it every 500ms
        
        function PRINT(text){
            document.getElementById("debug").textContent += (" | " + text);
        };
        
    const params = new URLSearchParams(document.location.search);
    window.onSpotifyWebPlaybackSDKReady = () => {
        //const token = params.get("access_token");
        const token = '{{ access_token }}';
        const player = new Spotify.Player({
            name: 'fspot player',
            getOAuthToken: cb => { cb(token); },
            volume: 1 //TODO: change to the pickled value
        });


        player.addListener('ready', ({ device_id }) => {
            //eventFire(document.getElementById("togglePlay"), "click");
            PRINT('ready');
        });



        // Not Ready
        player.addListener('not_ready', ({ device_id }) => {
            PRINT('Device ID has gone offline', device_id);
        });

        player.addListener('initialization_error', ({ message }) => {
            PRINT('init error');
        });

        player.addListener('authentication_error', ({ message }) => {

            PRINT('auth error');
        });

        player.addListener('account_error', ({ message }) => {
            PRINT('account error');
        });

        document.getElementById('togglePlay').onclick = function() {
            PRINT('BUTTON CLICKED');
            player.togglePlay();
        };
        player.pause().then(() => {
            PRINT('Paused!');
        });



        player.connect().then(success => {
            if (success) {
                PRINT('FSPOT successfully connected to Spotify!');
            }
        });


        //player.connect();
        //window.open('','_self').close() //closes the window


    }
    </script>
</body>
</html>

