
<!DOCTYPE html>
<html>
<head>
    <title>fspot</title>
</head>
<body>
    <h1>DEBUGGING</h1>
    <p id="debug"></p>
    <button id="togglePlay">Toggle Play</button>
    <p id="token">{{ access_token }}</p> <!-- gets access token from args in flask -->
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    <script>

    function PRINT(text){
        document.getElementById("debug").textContent += (" | " + text);
    };

    const params = new URLSearchParams(document.location.search);
    window.onSpotifyWebPlaybackSDKReady = () => {
        //const token = params.get("access_token");
        const token = document.getElementById("token").innerHTML; // stores the access token from the html

        const player = new Spotify.Player({
            name: 'fspot player',
            getOAuthToken: cb => { cb(token); },
            volume: 1 //TODO: change to the pickled value
        });


        player.addListener('ready', ({ device_id }) => {
            //eventFire(document.getElementById("togglePlay"), "click");
            PRINT('ready');
            player.resume();
        });



        // Not Ready
        player.addListener('not_ready', ({ device_id }) => {
            PRINT('Device ID has gone offline', device_id);
        });

        player.addListener('initialization_error', ({ message }) => {
            PRINT(message);
        });

        player.addListener('authentication_error', ({ message }) => {
            PRINT(message);
        });

        player.addListener('account_error', ({ message }) => {
            PRINT(message);
        });

        document.getElementById('togglePlay').onclick = function() {
            PRINT('BUTTON CLICKED');
            player.togglePlay();
        };
        player.pause().then(() => {
            PRINT('Paused!');
        });



        player.connect().then(success => {
            if (success) {
                PRINT('FSPOT successfully connected to Spotify!');
            }
        });


        //player.connect();
        //window.open('','_self').close() //closes the window


    }
    </script>
</body>
</html>

